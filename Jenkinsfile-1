pipeline {

    agent any
    environment{
        AWS_ACCESS_CRED = credentials('sabDG_aws_creds')
    }
    stages{
        stage('Git-checkout'){
            steps{
                echo " Checking out git Repo"
                git branch: 'python', url: 'https://github.com/sabshock/DataGrokr.git'
            }
        }
        stage('build'){
        
            steps{
                echo 'building the app'
            }   
        }
        stage("test"){
            steps{
                 echo "Test"
                 bat 'py test_calc.py'
            }
        }
        
        stage('build and Push image') {
            steps{
                echo 'building the image'
                bat 'docker build -t public.ecr.aws/b9y2x3m3/dg_devops_container/calc_app:""$BUILD_ID"" .'
                echo 'Pushing the image to AWS ECR'                  
                bat 'docker push public.ecr.aws/b9y2x3m3/dg_devops_container/calc_app:""$BUILD_ID""'
                
            }
        }
    }
    
    post {
        success{
            echo 'calculator app docker image is successfully got deloyed to AWS ECR'
        }

    }
}
